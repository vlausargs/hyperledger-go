# ---------------------------------------------------------------------------
# "IBM Corp." Confidential
#
# OCO Source Materials
#
# 5737-IBM
#
# (C) Copyright IBM Corp. 2018, 2020
#
# The source code for this program is not published or otherwise
# divested of its trade secrets, irrespective of what has been
# deposited with the U.S. Copyright Office.
# ---------------------------------------------------------------------------

# ---------------------------------------------------------------------------
# This is a configuration file for the configtxgen tool.
#
# The "Organizations" section contains configuration for each organization.
# It contains a "Name" key which specifies the name of the organization,
# a "ID" key which specifies the ID of the organization, a "MSPDir" key
# which specifies the path to the MSP directory for the organization, and
# a "Policies" section which contains the policies for the organization.
#
# The "Application" section contains configuration for the application group.
# It contains a "Policies" section which contains the policies for the
# application group, and an "Organizations" section which contains the
# organizations that are part of the application group.
#
# The "Orderer" section contains configuration for the orderer group.
# It contains a "Policies" section which contains the policies for the
# orderer group, and an "Organizations" section which contains the
# organizations that are part of the orderer group.
#
# The "Profiles" section contains configuration for each profile.
# It contains a "Channel" section which contains configuration for the channel,
# and an "Application" section which contains configuration for the application
# group. The "Channel" section contains a "Policies" section which contains the
# policies for the channel, and an "Organizations" section which contains the
# organizations that are part of the channel. The "Application" section
# contains a "Policies" section which contains the policies for the application
# group, and an "Organizations" section which contains the organizations that
# are part of the application group.
#
# Sample "configtxgen" configuration file
# ---------------------------------------------------------------------------

---
################################################################################
#
#   ORGANIZATIONS
#
#   This section defines the different organizational identities which will
#   be referenced later in the configuration.
#
################################################################################
Organizations:
  # ---------------------------------------------------------------------------
  # OrdererOrg defines the organization which runs the orderer nodes.
  # ---------------------------------------------------------------------------
  - &OrdererOrg
    Name: OrdererMSP

    ID: OrdererMSP

    MSPDir: ../crypto-config/ordererOrganizations/example.com/msp

    Policies:
      Readers:
        Type: Signature
        Rule: "OR('OrdererMSP.member')"
      Writers:
        Type: Signature
        Rule: "OR('OrdererMSP.member')"
      Admins:
        Type: Signature
        Rule: "OR('OrdererMSP.admin')"

    OrdererEndpoints:
      - orderer.example.com:7050

  # ---------------------------------------------------------------------------
  # SampleOrg defines an MSP using the sampleconfig. It should never be used
  # in production but may be used as a template for other definitions.
  # ---------------------------------------------------------------------------
  - &Org1
    # DefaultOrg defines the organization which is used in the sampleconfig
    # of the fabric.git repository. The defaultOrg is used by the
    # sampleconfig if no organization is specified.
    Name: Org1MSP

    # ID to load the MSP definition as
    ID: Org1MSP

    MSPDir: ../crypto-config/peerOrganizations/org1.example.com/msp

    # Policies defines the set of policies at this level of the config tree
    # For organization policies, their canonical path is usually
    #   /Channel/<Application|Orderer>/<OrgName>/<PolicyName>
    Policies:
      Readers:
        Type: Signature
        Rule: "OR('Org1MSP.member')"
      Writers:
        Type: Signature
        Rule: "OR('Org1MSP.member')"
      Admins:
        Type: Signature
        Rule: "OR('Org1MSP.admin')"

    # AnchorPeers defines the location of peers which can be used
    # for cross org gossip communication.
    AnchorPeers:
      - Host: peer0.org1.example.com
        Port: 7051

  - &Org2
    # DefaultOrg defines the organization which is used in the sampleconfig
    # of the fabric.git repository. The defaultOrg is used by the
    # sampleconfig if no organization is specified.
    Name: Org2MSP

    # ID to load the MSP definition as
    ID: Org2MSP

    MSPDir: ../crypto-config/peerOrganizations/org2.example.com/msp

    # Policies defines the set of policies at this level of the config tree
    # For organization policies, their canonical path is usually
    #   /Channel/<Application|Orderer>/<OrgName>/<PolicyName>
    Policies:
      Readers:
        Type: Signature
        Rule: "OR('Org2MSP.member')"
      Writers:
        Type: Signature
        Rule: "OR('Org2MSP.member')"
      Admins:
        Type: Signature
        Rule: "OR('Org2MSP.admin')"

    # AnchorPeers defines the location of peers which can be used
    # for cross org gossip communication.
    AnchorPeers:
      - Host: peer0.org2.example.com
        Port: 9051

################################################################################
#
#   CAPABILITIES
#
#   This section defines the capabilities of the fabric network. This is a
#   version 2.0 network, and includes features which are not available in
#   earlier networks.
#
################################################################################
Capabilities:
  # Channel capabilities apply to both the orderer and the peers
  # and must be supported by both.
  # Set the value of the capability to true to require it.
  Channel:
    &ChannelCapabilities # V2.0 for Channel is a catchall flag for V2.0 channel capabilities.
    V2_0: true

  # Orderer capabilities apply only to the orderers, and may be safely
  # used without an application peer.
  Orderer:
    &OrdererCapabilities # V2.0 for Orderer is a catchall flag for V2.0 orderer capabilities.
    V2_0: true

  # Application capabilities apply only to the peer network, and may be
  # safely used without an orderer.
  Application: &ApplicationCapabilities
    # V2.0 for Application enables the new non-backwards compatible
    # features and fixes of fabric v2.0.
    V2_0: true

################################################################################
#
#   APPLICATION
#
#   This section defines the values to encode into a config transaction or
#   channel creation transaction set for application related parameters.
#
################################################################################
Application: &ApplicationDefaults
  # Organizations is the list of orgs which are defined as participants on
  # the application side of the network
  Organizations:

  # Policies defines the set of policies at this level of the config tree
  # For Application policies, their canonical path is
  #   /Channel/Application/<PolicyName>
  Policies:
    Readers:
      Type: ImplicitMeta
      Rule: "ANY Readers"
    Writers:
      Type: ImplicitMeta
      Rule: "ANY Writers"
    Admins:
      Type: ImplicitMeta
      Rule: "MAJORITY Admins"
    LifecycleEndorsement:
      Type: ImplicitMeta
      Rule: "MAJORITY Endorsement"
    Endorsement:
      Type: ImplicitMeta
      Rule: "MAJORITY Endorsement"

################################################################################
#
#   ORDERER
#
#   This section defines the values to encode into a config transaction or
#   channel creation transaction set for orderer related parameters.
#
################################################################################
Orderer: &OrdererDefaults
  # Orderer Type: The orderer implementation to start
  # Available types are "solo" and "kafka"
  OrdererType: solo

  # Addresses used to be the list of orderer addresses that clients and peers
  # could connect to.  This field is deprecated in favor of Addresses,
  # which contains the same information.  This field is kept for backwards
  # compatibility and may be removed in a future release.  Deprecated, but
  # for now cannot be removed without breaking existing fabric deployments.
  Addresses:
    - orderer.example.com:7050

  # Batch Timeout: The amount of time to wait before creating a batch
  BatchTimeout: 2s

  # Batch Size: Controls the number of messages batched into a block
  BatchSize:
    # Max Message Count: The maximum number of messages to permit in a batch
    MaxMessageCount: 10

    # Absolute Max Bytes: The absolute maximum number of bytes allowed for
    # the serialized messages in a batch. If the "kafka" OrdererType is
    # selected, set 'AbsoluteMaxBytes' to 0 since batch size is controlled by
    # the Kafka producer queue size.
    AbsoluteMaxBytes: 99 MB

    # Preferred Max Bytes: The preferred maximum number of bytes allowed for
    # the serialized messages in a batch. A batch larger than this will
    # be split into smaller batches. The preferred maximum bytes of a batch
    # must be less than or equal to the AbsoluteMaxBytes.
    PreferredMaxBytes: 512 KB

  # Kafka:
  #   Brokers: A list of Kafka brokers to which the orderer connects. This
  #     field is only required if the OrdererType is set to "kafka".
  #   # NOTE: Use IP:port notation.
  #   Brokers:
  #     - 127.0.0.1:9092

  # EtcdRaft:
  #   Consenters:
  #     - Host: orderer.example.com
  #       Port: 7050
  #       ClientTLSCert: path/to/ClientTLSCert
  #       ServerTLSCert: path/to/ServerTLSCert

  # Organizations is the list of orgs which are defined as participants on
  # the orderer side of the network
  Organizations:

  # Policies defines the set of policies at this level of the config tree
  # For Orderer policies, their canonical path is
  #   /Channel/Orderer/<PolicyName>
  Policies:
    Readers:
      Type: ImplicitMeta
      Rule: "ANY Readers"
    Writers:
      Type: ImplicitMeta
      Rule: "ANY Writers"
    Admins:
      Type: ImplicitMeta
      Rule: "MAJORITY Admins"
    # BlockValidation specifies what signatures must be included in the block
    # from the orderer for the peer to validate it.
    BlockValidation:
      Type: ImplicitMeta
      Rule: "ANY Writers"

################################################################################
#
#   CHANNEL
#
#   This section defines the values to encode into a config transaction or
#   channel creation transaction set for channel related parameters.
#
################################################################################
Channel: &ChannelDefaults
  # Policies defines the set of policies at this level of the config tree
  # For Channel policies, their canonical path is
  #   /Channel/<PolicyName>
  Policies:
    # Who may invoke the 'Deliver' API
    Readers:
      Type: ImplicitMeta
      Rule: "ANY Readers"
    # Who may invoke the 'Broadcast' API
    Writers:
      Type: ImplicitMeta
      Rule: "ANY Writers"
    # By default, who may modify elements at this config level
    Admins:
      Type: ImplicitMeta
      Rule: "MAJORITY Admins"

  # Capabilities describes the channel level capabilities, see the
  # dedicated Capabilities section elsewhere in this file for a full
  # description
  Capabilities:
    <<: *ChannelCapabilities

################################################################################
#
#   PROFILES
#
#   Different configuration profiles may be encoded here to be specified
#   as parameters to the configtxgen tool.
#
################################################################################
Profiles:
  # ---------------------------------------------------------------------------
  # SampleSingleMSPChannel defines a channel with a single MSP.
  # ---------------------------------------------------------------------------
  # TwoOrgsChannel defines a channel with two organizations.
  TwoOrgsChannel:
    Consortium: SampleConsortium
    <<: *ChannelDefaults
    Application:
      <<: *ApplicationDefaults
      Organizations:
        - *Org1
        - *Org2
      Capabilities:
        <<: *ApplicationCapabilities

  # ---------------------------------------------------------------------------
  # SampleOrg defines an MSP using the sampleconfig. It should never be used
  # in production but may be used as a template for other definitions.
  # ---------------------------------------------------------------------------
  # TwoOrgsOrdererGenesis defines the orderer genesis block for the
  # two organization network.
  TwoOrgsOrdererGenesis:
    <<: *ChannelDefaults
    Orderer:
      <<: *OrdererDefaults
      Organizations:
        - *OrdererOrg
        - *Org1
        - *Org2
      Capabilities:
        <<: *OrdererCapabilities
    Consortiums:
      SampleConsortium:
        Organizations:
          - *OrdererOrg
          - *Org1
          - *Org2
